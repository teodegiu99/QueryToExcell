<Window
    x:Class="QueryToExcell.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:models="using:QueryToExcell.Models">

    <Grid>

        <Grid Padding="30">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <Grid Grid.Row="0" Margin="0,0,0,20">
                <StackPanel>
                    <TextBlock Text="Estrazioni Database" FontSize="28" FontWeight="Bold"/>
                    <TextBlock x:Name="TxtUserInfo" FontSize="14" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                </StackPanel>

                <Button x:Name="BtnAddQuery" 
                        Content="➕ Aggiungi Nuova Query" 
                        HorizontalAlignment="Right" 
                        VerticalAlignment="Top"
                        Style="{StaticResource AccentButtonStyle}"
                        Visibility="Collapsed" 
                        Click="BtnAddQuery_Click" />
            </Grid>

            <ListView x:Name="ListaEstrazioni" Grid.Row="1"
                      SelectionMode="None" IsItemClickEnabled="True" ItemClick="ListaEstrazioni_ItemClick">
                <ListView.ItemContainerStyle>
                    <Style TargetType="ListViewItem">
                        <Setter Property="Padding" Value="0" />
                        <Setter Property="Margin" Value="0,0,0,10" />
                    </Style>
                </ListView.ItemContainerStyle>
                <ListView.ItemTemplate>
                    <DataTemplate x:DataType="models:QueryInfo">
                        <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                                BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                BorderThickness="1"
                                CornerRadius="8"
                                Padding="16"
                                HorizontalAlignment="Stretch">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto" />
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>

                                <FontIcon Glyph="&#xE81E;" FontSize="24" Foreground="{ThemeResource SystemAccentColor}" Margin="0,0,16,0" VerticalAlignment="Center"/>

                                <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                    <TextBlock Text="{x:Bind Title}" FontSize="16" FontWeight="SemiBold" />
                                    <TextBlock Text="Clicca per inserire i parametri ed esportare in Excel" FontSize="12" Foreground="{ThemeResource TextFillColorSecondaryBrush}" Margin="0,4,0,0"/>
                                </StackPanel>

                                <FontIcon Grid.Column="2" Glyph="&#xE72A;" FontSize="16" Foreground="{ThemeResource TextFillColorTertiaryBrush}" VerticalAlignment="Center"/>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </ListView.ItemTemplate>
            </ListView>
        </Grid>

        <ContentDialog x:Name="DialogNuovaQuery" 
                       Title="Inserisci Nuova Estrazione" 
                       PrimaryButtonText="Salva Estrazione" 
                       CloseButtonText="Annulla"
                       PrimaryButtonClick="DialogNuovaQuery_PrimaryButtonClick">
            <ScrollViewer>
                <StackPanel Spacing="10" Width="800">
                    <TextBox x:Name="TxtTitolo" Header="Titolo Estrazione (es. Vendite)" />

                    <TextBox x:Name="TxtSql" Header="Query SQL (SENZA punto e virgola finale. Usa :Nome per Oracle)" 
                             AcceptsReturn="True" MinHeight="300" MaxHeight="500" TextWrapping="NoWrap"
                             ScrollViewer.VerticalScrollBarVisibility="Auto" ScrollViewer.HorizontalScrollBarVisibility="Auto"
                             FontFamily="Consolas" />

                    <TextBlock Text="Variabili (Parametri SQL)" FontWeight="Bold" Margin="0,15,0,0"/>
                    <StackPanel x:Name="ParametersListPanel" Spacing="5" />
                    <Button Content="➕ Aggiungi Variabile" Click="BtnAddParameterRow_Click" Margin="0,10,0,0"/>
                </StackPanel>
            </ScrollViewer>
        </ContentDialog>

        <Grid x:Name="LoadingOverlay" Background="{ThemeResource LayerOnAcrylicFillColorDefaultBrush}" Visibility="Collapsed">
            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center" Spacing="20">
                <ProgressRing IsActive="True" Width="80" Height="80" />
                <TextBlock Text="Estrazione in corso..." FontSize="20" FontWeight="SemiBold" HorizontalAlignment="Center" />
                <TextBlock Text="L'operazione potrebbe richiedere alcuni secondi, attendere." FontSize="14" Foreground="{ThemeResource TextFillColorSecondaryBrush}" HorizontalAlignment="Center" />
            </StackPanel>
        </Grid>

    </Grid>
</Window>